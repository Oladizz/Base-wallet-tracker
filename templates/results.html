<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Fee Report</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Gas Fee Report for <code>{{ wallet_address }}</code></h1>

        {% if error_messages %}
            <div class="section error-message-section">
                <h2>Errors/Warnings:</h2>
                {% for msg in error_messages %}
                    <p class="error-message">{{ msg }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <div class="section" id="queried-address">
            <h2>Queried Wallet Address</h2>
            <p><strong>Address:</strong> <code>{{ wallet_address }}</code></p>
        </div>

        <div class="section" id="current-gas-price">
            <h2>Current L2 Gas Price</h2>
            <p>{{ current_l2_gas_price_gwei }}</p>
        </div>
        
        <div class="section" id="current-eth-price">
            <h2>Current ETH Price</h2>
            <p>{{ current_eth_usd_price }}</p>
        </div>

        <div class="section" id="gas-summary">
            <h2>Gas Fee Summary</h2>
            <p><strong>All Time:</strong> {{ gas_summary.all_time.eth }} 
                {% if gas_summary.all_time.usd != "$--.-- USD" and gas_summary.all_time.usd != "$0.00 USD" %}
                    ({{ gas_summary.all_time.usd }})
                {% elif gas_summary.all_time.eth != "0.00 ETH" %} 
                    (USD N/A) 
                {% endif %}
            </p>
            <p><strong>Last 30 Days:</strong> {{ gas_summary.last_30_days.eth }}
                {% if gas_summary.last_30_days.usd != "$--.-- USD" and gas_summary.last_30_days.usd != "$0.00 USD" %}
                    ({{ gas_summary.last_30_days.usd }})
                {% elif gas_summary.last_30_days.eth != "0.00 ETH" %}
                     (USD N/A) 
                {% endif %}
            </p>
            <p><strong>Last 7 Days:</strong> {{ gas_summary.last_7_days.eth }}
                {% if gas_summary.last_7_days.usd != "$--.-- USD" and gas_summary.last_7_days.usd != "$0.00 USD" %}
                    ({{ gas_summary.last_7_days.usd }})
                {% elif gas_summary.last_7_days.eth != "0.00 ETH" %}
                     (USD N/A) 
                {% endif %}
            </p>
        </div>

        <div class="section" id="gas-graph">
            <h2>Gas Spending Graph (Last 30 Days)</h2>
            {% if graph_url %}
                <div class="graph-container">
                    <img src="{{ graph_url }}" alt="Gas Spending Graph for last 30 days">
                </div>
            {% else %}
                <p class="text-center">Gas spending graph is not available. (May require transactions within the last 30 days)</p>
            {% endif %}
        </div>

        <div class="section" id="recent-transactions">
            <h2>Recent Transactions (Up to 20)</h2>
            {% if transactions %}
                <table>
                    <thead>
                        <tr>
                            <th>Hash</th>
                            <th>Timestamp</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Value (ETH)</th>
                            <th>Gas Fee</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tx_dict in transactions %} {# Changed loop var name for clarity #}
                        <tr>
                            <td><a href="https://basescan.org/tx/{{ tx_dict.hash }}" target="_blank" title="{{ tx_dict.hash }}">{{ tx_dict.hash[:10] }}...{{ tx_dict.hash[-8:] }}</a></td>
                            <td>{{ tx_dict.timestamp_dt_str }}</td>
                            <td><a href="https://basescan.org/address/{{ tx_dict.from_address }}" target="_blank" title="{{ tx_dict.from_address }}">{{ tx_dict.from_address[:10] }}...{{ tx_dict.from_address[-8:] }}</a></td>
                            <td><a href="https://basescan.org/address/{{ tx_dict.to_address }}" target="_blank" title="{{ tx_dict.to_address }}">{{ tx_dict.to_address[:10] }}...{{ tx_dict.to_address[-8:] }}</a></td>
                            <td>{{ tx_dict.value_eth_str }}</td>
                            <td>{{ tx_dict.gas_fee_eth_str }} 
                                {% if tx_dict.gas_fee_usd_str != "$--.-- USD" and tx_dict.gas_fee_usd_str != "$0.00 USD" and tx_dict.gas_fee_usd_str != "$Error USD" %}
                                    ({{ tx_dict.gas_fee_usd_str }})
                                {% elif tx_dict.gas_fee_eth_str != "N/A" and tx_dict.gas_fee_eth_str != "0.00 ETH" %}
                                    (USD N/A)
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-center">No transactions found for this address, or an error occurred while fetching them.</p>
            {% endif %}
        </div>

        <a href="/" class="back-link">Track another wallet</a>
        </div>
    </div>
</body>
</html>
